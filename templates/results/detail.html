{% extends "base/base.html" %}
{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã: {{ event.description }} ‚Äî Sound Party{% endblock %}

{% block breadcrumbs %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
    <li class="breadcrumb-item"><a href="/results">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</a></li>
    <li class="breadcrumb-item active" aria-current="page">{{ event.description }}</li>
  </ol>
</nav>
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-lg-8">
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏ -->
    <div class="card mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h3 class="mb-0">
          <i class="fas fa-trophy"></i> {{ event.description }}
        </h3>
        <span class="badge bg-success fs-6">
          <i class="fas fa-check"></i> –ó–∞–≤–µ—Ä—à–µ–Ω–æ
        </span>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <table class="table table-borderless">
              <tr>
                <td><i class="fas fa-calendar-alt text-primary"></i> <strong>–î–∞—Ç–∞:</strong></td>
                <td>{{ event.date }}</td>
              </tr>
              <tr>
                <td><i class="fas fa-clock text-primary"></i> <strong>–í—Ä–µ–º—è:</strong></td>
                <td>{{ event.time }}</td>
              </tr>
              <tr>
                <td><i class="fas fa-users text-primary"></i> <strong>–£—á–∞—Å—Ç–≤–æ–≤–∞–ª–æ –∫–æ–º–∞–Ω–¥:</strong></td>
                <td>{{ results|length if results else 0 }}</td>
              </tr>
            </table>
          </div>
          <div class="col-md-6">
            <table class="table table-borderless">
              <tr>
                <td><i class="fas fa-map-marker-alt text-primary"></i> <strong>–ü–ª–æ—â–∞–¥–∫–∞:</strong></td>
                <td>{{ event.venue_name }}</td>
              </tr>
              <tr>
                <td><i class="fas fa-building text-primary"></i> <strong>–ê–¥—Ä–µ—Å:</strong></td>
                <td>{{ event.address or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</td>
              </tr>
              <tr>
                <td><i class="fas fa-chair text-primary"></i> <strong>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:</strong></td>
                <td>{{ event.capacity }} —á–µ–ª.</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
          <i class="fas fa-medal"></i> –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        </h5>
        <div>
          <button class="btn btn-outline-primary btn-sm" onclick="printResults()">
            <i class="fas fa-print"></i> –ü–µ—á–∞—Ç—å
          </button>
          <button class="btn btn-outline-success btn-sm" onclick="exportResults()">
            <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç
          </button>
        </div>
      </div>
      <div class="card-body">
        {% if results %}
          <!-- –ü–æ–¥–∏—É–º (—Ç–æ–ø-3) -->
          <div class="row mb-4">
            {% set sorted_results = results|sort(attribute='score', reverse=true) %}
            
            <!-- 2 –º–µ—Å—Ç–æ -->
            {% if sorted_results|length >= 2 %}
            <div class="col-md-4">
              <div class="text-center podium-place" data-place="2">
                <div class="podium-box bg-secondary text-white p-3 rounded">
                  <i class="fas fa-medal fa-2x mb-2"></i>
                  <h4>2 –º–µ—Å—Ç–æ</h4>
                  <h5>{{ sorted_results[1].team_name }}</h5>
                  <p class="mb-0">{{ sorted_results[1].score }} –±–∞–ª–ª–æ–≤</p>
                </div>
              </div>
            </div>
            {% endif %}
            
            <!-- 1 –º–µ—Å—Ç–æ -->
            {% if sorted_results|length >= 1 %}
            <div class="col-md-4">
              <div class="text-center podium-place" data-place="1">
                <div class="podium-box bg-warning text-dark p-4 rounded position-relative">
                  <i class="fas fa-crown fa-3x mb-3"></i>
                  <h3>üèÜ 1 –º–µ—Å—Ç–æ</h3>
                  <h4><strong>{{ sorted_results[0].team_name }}</strong></h4>
                  <h5 class="mb-0">{{ sorted_results[0].score }} –±–∞–ª–ª–æ–≤</h5>
                  <div class="position-absolute top-0 start-50 translate-middle">
                    <span class="badge bg-warning text-dark rounded-pill px-3 py-2">
                      <i class="fas fa-star"></i> –ü–û–ë–ï–î–ò–¢–ï–õ–¨
                    </span>
                  </div>
                </div>
              </div>
            </div>
            {% endif %}
            
            <!-- 3 –º–µ—Å—Ç–æ -->
            {% if sorted_results|length >= 3 %}
            <div class="col-md-4">
              <div class="text-center podium-place" data-place="3">
                <div class="podium-box bg-danger text-white p-3 rounded">
                  <i class="fas fa-medal fa-2x mb-2"></i>
                  <h4>3 –º–µ—Å—Ç–æ</h4>
                  <h5>{{ sorted_results[2].team_name }}</h5>
                  <p class="mb-0">{{ sorted_results[2].score }} –±–∞–ª–ª–æ–≤</p>
                </div>
              </div>
            </div>
            {% endif %}
          </div>

          <!-- –ü–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-dark">
                <tr>
                  <th class="text-center" width="80">–ú–µ—Å—Ç–æ</th>
                  <th>–ö–æ–º–∞–Ω–¥–∞</th>
                  <th class="text-center" width="120">–ë–∞–ª–ª—ã</th>
                  <th class="text-center" width="100">–ù–∞–≥—Ä–∞–¥–∞</th>
                </tr>
              </thead>
              <tbody>
                {% for result in sorted_results %}
                <tr class="{% if loop.index <= 3 %}table-warning{% endif %}">
                  <td class="text-center">
                    {% if loop.index == 1 %}
                      <span class="badge bg-warning text-dark fs-5">
                        <i class="fas fa-trophy"></i> 1
                      </span>
                    {% elif loop.index == 2 %}
                      <span class="badge bg-secondary fs-5">
                        <i class="fas fa-medal"></i> 2
                      </span>
                    {% elif loop.index == 3 %}
                      <span class="badge bg-danger fs-5">
                        <i class="fas fa-medal"></i> 3
                      </span>
                    {% else %}
                      <span class="fs-5">{{ loop.index }}</span>
                    {% endif %}
                  </td>
                  <td>
                    <div class="d-flex align-items-center">
                      <i class="fas fa-users text-primary me-2"></i>
                      <strong>{{ result.team_name }}</strong>
                      {% if loop.index == 1 %}
                        <i class="fas fa-crown text-warning ms-2"></i>
                      {% endif %}
                    </div>
                  </td>
                  <td class="text-center">
                    <span class="badge bg-primary fs-6">{{ result.score }}</span>
                  </td>
                  <td class="text-center">
                    {% if loop.index == 1 %}
                      <i class="fas fa-trophy text-warning" title="–ó–æ–ª–æ—Ç–æ"></i>
                    {% elif loop.index == 2 %}
                      <i class="fas fa-medal text-secondary" title="–°–µ—Ä–µ–±—Ä–æ"></i>
                    {% elif loop.index == 3 %}
                      <i class="fas fa-medal text-danger" title="–ë—Ä–æ–Ω–∑–∞"></i>
                    {% else %}
                      <i class="fas fa-certificate text-muted" title="–£—á–∞—Å—Ç–∏–µ"></i>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="text-center py-5">
            <i class="fas fa-info-circle fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –µ—â–µ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã</h4>
            <p class="text-muted">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç—Ç–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –ø–æ–∫–∞ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã</p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
      </div>
      <div class="card-body">
        {% if results %}
          <div class="row text-center">
            <div class="col-6">
              <h3 class="text-primary">{{ results|length }}</h3>
              <p class="text-muted mb-0">–ö–æ–º–∞–Ω–¥ —É—á–∞—Å—Ç–≤–æ–≤–∞–ª–æ</p>
            </div>
            <div class="col-6">
              <h3 class="text-success">{{ results|map(attribute='score')|max }}</h3>
              <p class="text-muted mb-0">–ú–∞–∫—Å–∏–º—É–º –±–∞–ª–ª–æ–≤</p>
            </div>
            <div class="col-6 mt-3">
              <h3 class="text-info">{{ (results|map(attribute='score')|sum / results|length)|round(1) }}</h3>
              <p class="text-muted mb-0">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</p>
            </div>
            <div class="col-6 mt-3">
              <h3 class="text-warning">{{ results|map(attribute='score')|min }}</h3>
              <p class="text-muted mb-0">–ú–∏–Ω–∏–º—É–º –±–∞–ª–ª–æ–≤</p>
            </div>
          </div>
        {% else %}
          <p class="text-muted text-center">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>
        {% endif %}
      </div>
    </div>

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-cog"></i> –î–µ–π—Å—Ç–≤–∏—è</h5>
      </div>
      <div class="card-body">
        <div class="d-grid gap-2">
          <a href="/events/{{ event.event_id }}" class="btn btn-outline-primary">
            <i class="fas fa-info-circle"></i> –û –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏
          </a>
          <a href="/results" class="btn btn-outline-secondary">
            <i class="fas fa-list"></i> –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
          </a>
          {% if current_user and current_user.role_id <= 2 %}
            <a href="/organizer/results" class="btn btn-outline-warning">
              <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </a>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–∏ -->
    {% if results and results|length >= 3 %}
    <div class="card mt-4">
      <div class="card-header bg-warning">
        <h5 class="mb-0"><i class="fas fa-award"></i> –ù–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ</h5>
      </div>
      <div class="card-body">
        <div class="award-list">
          {% set sorted_results = results|sort(attribute='score', reverse=true) %}
          <div class="mb-2">
            <i class="fas fa-trophy text-warning"></i>
            <strong>1 –º–µ—Å—Ç–æ:</strong> {{ sorted_results[0].team_name }}
          </div>
          <div class="mb-2">
            <i class="fas fa-medal text-secondary"></i>
            <strong>2 –º–µ—Å—Ç–æ:</strong> {{ sorted_results[1].team_name }}
          </div>
          <div class="mb-2">
            <i class="fas fa-medal text-danger"></i>
            <strong>3 –º–µ—Å—Ç–æ:</strong> {{ sorted_results[2].team_name }}
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<style>
.podium-place[data-place="1"] .podium-box {
  transform: scale(1.1);
  z-index: 10;
  position: relative;
}

.podium-place[data-place="2"] .podium-box {
  margin-top: 20px;
}

.podium-place[data-place="3"] .podium-box {
  margin-top: 30px;
}

.podium-box {
  transition: transform 0.3s ease;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.podium-box:hover {
  transform: translateY(-5px);
}

.award-list i {
  width: 20px;
}

@media print {
  .btn, .card-header button {
    display: none !important;
  }
}
</style>

<script>
function printResults() {
  window.print();
}

function exportResults() {
  // –ò–º–∏—Ç–∞—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  const eventName = '{{ event.description }}';
  alert(`–≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è "${eventName}" –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω`);
}

// –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ–¥–∏—É–º–∞
document.addEventListener('DOMContentLoaded', function() {
  const podiumPlaces = document.querySelectorAll('.podium-place');
  podiumPlaces.forEach((place, index) => {
    setTimeout(() => {
      place.style.opacity = '0';
      place.style.transform = 'translateY(50px)';
      place.style.transition = 'all 0.6s ease';
      
      setTimeout(() => {
        place.style.opacity = '1';
        place.style.transform = 'translateY(0)';
      }, 100);
    }, index * 200);
  });
});
</script>
{% endblock %}